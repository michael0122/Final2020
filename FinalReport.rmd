---
title: "Snippets"
author: "Dr K"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`"    
    
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
OldData <-read.csv(file="covid91.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- OldData %>% mutate(infected = recode(infected, aids = "covid", none = "OK" )) %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
##FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
FinalData$infected <- relevel(FinalData$infected,ref="OK")
guy = filter(FinalData, sex == "guy")
gal = filter(FinalData, sex == "gal")
gay = filter(FinalData, LGBTQ == "gay")
Druguser = filter(FinalData, DrugUser == "yes")
```

# Introduction  

A new  preventative vaccine (covid91) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

# Coding Details  

```{r}
Maledata <- filter(FinalData, sex == "guy")
Maledata$sex <- as.factor(Maledata$sex)
Maledata$treatment <- as.factor(Maledata$treatment)
```


# Guys   

## Barplot   

```{r}
dd2 <- guy %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

the barchart is showing that 337 people were infected with covid19 and almost 58% were infected when they got the drug and about 42% were infected have received the placebo 


## Numerical Results    

```{r}
table1 <- xtabs(~infected + treatment, data=guy)
rowPerc(table1)
colPerc(table1)
```

this is the H 0 which is the null hypothesis 1.473872  so the vaccine is not effective so we will reject the null hypothesis.


## Inferarential    

```{r}
chisq.test(table1)
chisqtestGC(table1)
guysfish <- fisher.test(table1)
guysfish
```

this table illustrates that 3.72% of the guys who received the covid drug has gotten covid however 2.55% of the Guys who has been treated with the placebo were able to contract covid. In this data it is shown that 50% of the males who received the vaccine are most likely to get affected with covid as that shows that the vaccine is not effective on guys. 


```{r}
effect <- guysfish$p.value/(guysfish$p.value  +1)
effectiveness =  guysfish$estimate/(guysfish$estimate+1)
print(effectiveness*100)
```

```{r}
low=(guysfish$conf.int[1]/(guysfish$conf.int[1] +1))
hi=(guysfish$conf.int[2]/(guysfish$conf.int[2] +1))
options(digits=2)
```

## ## Effectiveness Confidence Interval `r low`  to `r hi`



# Gals 

```{r}
Femaledata <- filter(FinalData, sex == "gal")
Femaledata$sex <- as.factor(Femaledata$sex)
Femaledata$infected = factor(Femaledata$infected)
Femaledata$infected <- relevel(Femaledata$infected, "OK")
levels(Femaledata$infected)
```


```{r}
gals <- Femaledata %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(gals,aes(x=treatment,y=count,fill=infected))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(gals,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```


```{r}
table2 <- xtabs(~treatment + infected, data=Femaledata)
rowPerc(table2)
colPerc(table2)
print(table2)
```

```{r}
chisq.test(table2)
chisqtestGC(table2)
fisher.test(table2)
```

# Sexual orintation "LGBTQ = gay"


```{r}
LGBTQdata <- filter(FinalData, LGBTQ == "gay")
LGBTQdata$DrugUser <- as.factor(LGBTQdata$LGBTQ)
LGBTQdata$infected <- as.factor(LGBTQdata$infected)
LGBTQdata$infected <- relevel(LGBTQdata$infected, "OK")
```


```{r}
LGBTQ <- LGBTQdata %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(LGBTQ,aes(x=treatment,y=count,fill=infected))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(LGBTQ,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```



```{r}
table3 <- xtabs(~treatment + infected, data=LGBTQdata)
rowPerc(table3)
colPerc(table3)
print(table3)
```

```{r}
chisq.test(table3)
chisqtestGC(table3)
fisher.test(table3)
```

# Drug Users "Drug User = yes"

